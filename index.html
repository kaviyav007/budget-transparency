<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CivicSpend Pro | Public Transparency Portal</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        :root {
            --brand: #2563eb;
            --brand-soft: #eff6ff;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --slate-900: #0f172a;
            --slate-600: #475569;
            --slate-100: #f1f5f9;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background-color: #f8fafc; 
            color: var(--slate-900);
            scroll-behavior: smooth;
        }

        /* Loading Screen */
        #loadingScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.3s ease;
        }
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid var(--brand-soft);
            border-top: 5px solid var(--brand);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* MODALS */
        .modal {
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0,0,0,0.5); 
            z-index: 2000; 
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 1;
        }
        .modal-content {
            background: white; 
            margin: 20px; 
            width: 90%; 
            max-width: 500px; 
            border-radius: 20px; 
            padding: 40px; 
            position: relative;
            transform: translateY(-20px);
            transition: transform 0.3s ease;
            max-height: 90vh;
            overflow-y: auto;
        }
        .modal.show .modal-content {
            transform: translateY(0);
        }
        .close-modal { 
            position: absolute; 
            top: 20px; 
            right: 25px; 
            font-size: 2rem; 
            cursor: pointer; 
            color: var(--slate-600);
            background: none;
            border: none;
        }
        .close-modal:hover { color: var(--slate-900); }

        /* NAVIGATION */
        nav {
            background: rgba(255, 255, 255, 0.95); 
            backdrop-filter: blur(10px);
            padding: 1rem 5%; 
            display: flex; 
            justify-content: space-between;
            align-items: center; 
            border-bottom: 1px solid var(--slate-100);
            position: sticky; 
            top: 0; 
            z-index: 1000;
        }
        .logo { 
            font-weight: 800; 
            font-size: 1.4rem; 
            color: var(--brand); 
            letter-spacing: -0.5px; 
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .nav-links { 
            display: flex; 
            align-items: center; 
            gap: 24px;
        }
        .nav-link { 
            text-decoration: none; 
            color: var(--slate-600); 
            font-weight: 600; 
            font-size: 0.9rem; 
            transition: 0.2s; 
            cursor: pointer;
        }
        .nav-link:hover { color: var(--brand); }
        .user-status { 
            font-weight: 600; 
            color: var(--brand); 
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .admin-badge { 
            background: #fef3c7; 
            color: var(--warning); 
            padding: 4px 12px; 
            border-radius: 20px; 
            font-size: 0.75rem; 
            font-weight: 700; 
        }
        #languageSelect {
            padding: 8px 12px; 
            border-radius: 8px; 
            border: 1px solid #e2e8f0; 
            background: white; 
            cursor: pointer;
            font-family: 'Plus Jakarta Sans', sans-serif;
        }

        /* HERO */
        .hero {
            padding: 120px 10% 160px; 
            text-align: center;
            background: radial-gradient(circle at 50% 0%, #e0f2fe 0%, #f8fafc 100%);
        }
        .hero h1 { 
            font-size: 3.5rem; 
            font-weight: 800; 
            margin-bottom: 1.5rem; 
            line-height: 1.1; 
            letter-spacing: -1.5px; 
        }
        .hero p { 
            font-size: 1.25rem; 
            color: var(--slate-600); 
            max-width: 800px; 
            margin: 0 auto 3rem; 
            line-height: 1.6; 
        }
        .cta-group { 
            display: flex; 
            gap: 15px; 
            justify-content: center; 
            flex-wrap: wrap; 
        }
        .btn { 
            padding: 16px 32px; 
            border-radius: 14px; 
            font-weight: 700; 
            text-decoration: none; 
            transition: 0.3s; 
            cursor: pointer; 
            border: none; 
            font-size: 1rem;
            font-family: 'Plus Jakarta Sans', sans-serif;
        }
        .btn-primary { 
            background: var(--brand); 
            color: white; 
            box-shadow: 0 10px 15px -3px rgba(37, 99, 235, 0.3); 
        }
        .btn-primary:hover { 
            transform: translateY(-3px); 
            box-shadow: 0 20px 25px -5px rgba(37, 99, 235, 0.3); 
        }
        .btn-secondary { 
            background: white; 
            border: 2px solid var(--brand); 
            color: var(--brand); 
        }
        .btn-secondary:hover {
            background: var(--brand-soft);
        }
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        .btn-danger:hover {
            background: #dc2626;
        }

        /* DASHBOARD */
        .dashboard-container {
            max-width: 1400px; 
            margin: -100px auto 100px; 
            padding: 0 20px;
            display: grid; 
            grid-template-columns: 1.8fr 1fr; 
            gap: 40px;
        }
        .card { 
            background: white; 
            border-radius: 28px; 
            padding: 40px; 
            border: 1px solid var(--slate-100); 
            box-shadow: 0 10px 30px rgba(0,0,0,0.04); 
            position: relative;
            margin-bottom: 40px;
        }
        .data-freshness { 
            position: absolute; 
            top: 20px; 
            right: 20px; 
            font-size: 0.75rem; 
            color: var(--success); 
            font-weight: 600; 
        }

        /* STATS & CHARTS */
        .badge { 
            display: inline-block; 
            padding: 6px 16px; 
            border-radius: 20px; 
            font-size: 0.75rem; 
            font-weight: 800; 
            text-transform: uppercase; 
            margin-bottom: 15px; 
        }
        .badge-blue { background: var(--brand-soft); color: var(--brand); }
        .badge-green { background: #dcfce7; color: #166534; }
        .badge-orange { background: #fef3c7; color: #92400e; }
        .stats-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); 
            gap: 20px; 
            margin-bottom: 30px; 
        }
        .stat-card { 
            background: white; 
            padding: 20px; 
            border-radius: 16px; 
            text-align: center; 
            border: 1px solid #f3e8ff; 
            transition: transform 0.2s;
        }
        .stat-card:hover {
            transform: translateY(-5px);
        }
        .stat-number { 
            font-size: 2rem; 
            font-weight: 800; 
            color: var(--brand); 
            margin-bottom: 5px;
        }
        .vote-demographics { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 20px; 
            margin-top: 30px;
        }
        .demographic-chart { 
            height: 250px; 
            width: 100%;
        }

        /* SEARCH & TABLE */
        .search-container { 
            position: relative; 
            margin-bottom: 20px; 
        }
        .search-input { 
            width: 100%; 
            padding: 14px 45px 14px 16px; 
            border: 2px solid #e2e8f0; 
            border-radius: 12px; 
            font-size: 1rem;
            font-family: 'Plus Jakarta Sans', sans-serif;
        }
        .search-icon { 
            position: absolute; 
            right: 16px; 
            top: 50%; 
            transform: translateY(-50%); 
            color: var(--slate-600); 
        }
        .download-btns { 
            display: flex; 
            gap: 10px; 
            margin-top: 15px; 
        }
        .download-btns button { 
            flex: 1; 
            padding: 10px; 
            border-radius: 8px; 
            border: 1px solid #e2e8f0; 
            background: white; 
            cursor: pointer; 
            font-weight: 600;
            font-family: 'Plus Jakarta Sans', sans-serif;
        }
        .ledger-table { 
            width: 100%; 
            border-collapse: collapse; 
            margin-top: 20px; 
            font-size: 0.9rem; 
        }
        .ledger-table th, .ledger-table td { 
            padding: 12px; 
            text-align: left; 
            border-bottom: 1px solid #f1f5f9; 
        }
        .ledger-table th { 
            background: #f8fafc; 
            font-weight: 700; 
            color: var(--slate-900); 
        }
        .ledger-table tr:hover { 
            background: var(--brand-soft); 
        }

        /* MAP */
        #project-map { 
            height: 400px; 
            border-radius: 16px; 
            margin-top: 20px; 
            z-index: 1;
        }

        /* FORMS */
        .input-group { 
            background: #f8fafc; 
            padding: 22px; 
            border-radius: 18px; 
            margin-bottom: 20px; 
            border: 1px solid #e2e8f0; 
        }
        .input-group label { 
            display: flex; 
            justify-content: space-between; 
            font-weight: 700; 
            font-size: 1rem; 
            margin-bottom: 10px;
        }
        input[type=range] { 
            width: 100%; 
            height: 8px; 
            accent-color: var(--brand); 
            margin: 18px 0 10px; 
            cursor: pointer; 
        }
        select, input[type="text"], input[type="email"], input[type="password"], input[type="tel"], textarea { 
            width: 100%; 
            padding: 12px; 
            border: 1px solid #e2e8f0; 
            border-radius: 8px; 
            margin: 8px 0; 
            font-family: 'Plus Jakarta Sans', sans-serif;
        }

        /* ADMIN */
        .admin-section { 
            background: #fef7ff; 
            border: 2px solid #e879f9; 
            border-radius: 20px; 
            padding: 30px; 
            margin-bottom: 20px; 
        }
        #adminDashboard { display: none; }

        /* CHATBOT */
        #chatbot { 
            position: fixed; 
            right: 18px; 
            bottom: 18px; 
            z-index: 3000; 
        }
        #chatbotPanel { 
            display: none; 
            width: 320px; 
            max-width: 85vw; 
            height: 420px; 
            background: white; 
            border: 1px solid #e2e8f0; 
            border-radius: 18px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.15); 
            margin-top: 10px; 
            overflow: hidden; 
        }

        /* SECTIONS */
        .section { padding: 100px 10%; }
        .section-title { 
            text-align: center; 
            margin-bottom: 60px; 
        }
        .section-title h2 { 
            font-size: 2.5rem; 
            font-weight: 800; 
            margin-bottom: 15px;
        }
        .grid-3 { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
            gap: 40px; 
        }
        .step-card { 
            padding: 30px; 
            text-align: left; 
            border-radius: 20px; 
            background: #f8fafc; 
            border: 1px solid #f1f5f9; 
            transition: transform 0.3s;
        }
        .step-card:hover {
            transform: translateY(-5px);
        }
        .step-num { 
            width: 40px; 
            height: 40px; 
            background: var(--brand); 
            color: white; 
            border-radius: 10px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-weight: 800; 
            margin-bottom: 20px; 
        }
        .accordion-item { 
            background: white; 
            margin-bottom: 15px; 
            border-radius: 15px; 
            border: 1px solid #e2e8f0; 
            overflow: hidden; 
        }
        .accordion-header { 
            padding: 20px 25px; 
            cursor: pointer; 
            display: flex; 
            justify-content: space-between; 
            font-weight: 700; 
            transition: 0.3s; 
        }
        .accordion-header:hover { 
            background: var(--brand-soft); 
        }
        .accordion-content { 
            padding: 0 25px; 
            color: var(--slate-600); 
            font-size: 0.95rem; 
            line-height: 1.6; 
            max-height: 0; 
            overflow: hidden; 
            transition: 0.3s; 
        }
        .accordion-content.active { 
            max-height: 500px; 
            padding: 0 25px 20px; 
        }
        .news-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); 
            gap: 30px; 
        }
        .news-card { 
            border-radius: 20px; 
            overflow: hidden; 
            border: 1px solid #f1f5f9; 
            transition: 0.3s; 
            position: relative; 
        }
        .news-card:hover { 
            transform: translateY(-5px); 
            box-shadow: 0 10px 20px rgba(0,0,0,0.05); 
        }
        .report-issue { 
            position: absolute; 
            bottom: 10px; 
            right: 10px; 
            background: var(--danger); 
            color: white; 
            padding: 4px 8px; 
            border-radius: 4px; 
            font-size: 0.7rem; 
            cursor: pointer; 
        }

        /* RESPONSIVE */
        @media (max-width: 1000px) { 
            .dashboard-container { grid-template-columns: 1fr; } 
            .hero h1 { font-size: 2.8rem; }
            .vote-demographics { grid-template-columns: 1fr; }
            .nav-links { flex-wrap: wrap; }
        }
        @media (max-width: 768px) {
            .hero { padding: 80px 5% 120px; }
            .hero h1 { font-size: 2.2rem; }
            .section { padding: 60px 5%; }
            .card { padding: 25px; }
        }
        footer { 
            background: var(--slate-900); 
            color: white; 
            padding: 80px 10%; 
            margin-top: 0; 
        }
        .footer-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 50px; 
        }
        .footer-bottom { 
            border-top: 1px solid #334155; 
            margin-top: 60px; 
            padding-top: 30px; 
            font-size: 0.85rem; 
            color: #94a3b8; 
            text-align: center; 
        }
        .footer-grid a {
            color: #94a3b8;
            text-decoration: none;
            display: block;
            margin-bottom: 10px;
        }
        .footer-grid a:hover {
            color: white;
        }
        
        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--success);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 10000;
            transition: transform 0.3s ease;
        }
        .toast.show {
            transform: translateX(-50%) translateY(0);
        }
        .toast.error {
            background: var(--danger);
        }
        
        /* Vote Slider Container */
        .slider-container {
            margin: 15px 0;
        }
        .slider-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            font-size: 0.85rem;
            color: var(--slate-600);
        }
    </style>
</head>
<body>

<!-- Loading Screen -->
<div id="loadingScreen">
    <div class="spinner"></div>
    <h3 style="color: var(--brand); margin-bottom: 10px;">Loading CivicSpend Pro</h3>
    <p style="color: var(--slate-600);">Initializing transparency portal...</p>
</div>

<!-- MODALS -->
<div id="entryModal" class="modal">
    <div class="modal-content">
        <h3>Welcome to CivicSpend Pro</h3>
        <p style="color:var(--slate-600)">Choose how you want to access the platform:</p>
        <div style="display:flex; gap:12px; margin-top:30px; flex-direction:column;">
            <button class="btn btn-primary" onclick="chooseEntry('user')">üë§ Continue as User</button>
            <button class="btn btn-secondary" onclick="chooseEntry('admin')">üõ°Ô∏è Continue as Admin</button>
            <button class="btn" onclick="enterAsGuest()" style="border:1px solid #e2e8f0; background:white;">
                üëÅÔ∏è Browse as Guest (no vote)
            </button>
        </div>
    </div>
</div>

<div id="userLoginModal" class="modal">
    <div class="modal-content">
        <button class="close-modal" onclick="closeModal('userLoginModal')">&times;</button>
        <h3>User Login</h3>
        <div id="userLoginForm">
            <input type="tel" id="phoneNumber" placeholder="Enter phone number (10 digits)" 
                   style="margin-bottom: 15px;" maxlength="10">
            <button class="btn btn-primary" onclick="sendOTP()" style="width:100%">Send OTP</button>
            <p style="text-align: center; margin-top: 15px; font-size: 0.9rem; color: var(--slate-600);">
                Demo: OTP will be 123456
            </p>
        </div>
        <div id="otpContainer" style="display: none;">
            <input type="text" id="verificationCode" placeholder="Enter OTP (123456 for demo)" 
                   style="margin-bottom: 15px;" maxlength="6">
            <button class="btn btn-primary" onclick="verifyOTP()" style="width:100%">Verify & Login</button>
        </div>
    </div>
</div>

<div id="adminLoginModal" class="modal">
    <div class="modal-content">
        <button class="close-modal" onclick="closeModal('adminLoginModal')">&times;</button>
        <h3>Admin Login</h3>
        <input type="email" id="adminEmail" placeholder="Enter any email" style="margin-bottom: 15px;">
        <input type="password" id="adminPassword" placeholder="Enter any password" style="margin-bottom: 15px;">
        <button class="btn btn-primary" onclick="adminLogin()" style="width:100%">Login as Admin</button>
        <p style="text-align: center; margin-top: 15px; font-size: 0.9rem; color: var(--slate-600);">
            Accepts any email/password
        </p>
    </div>
</div>

<!-- NAVIGATION -->
<nav>
    <div class="logo">üèôÔ∏è CivicSpend Pro</div>
    <div class="nav-links">
        <a class="nav-link" onclick="scrollToSection('dashboard')">Dashboard</a>
        <a class="nav-link" onclick="scrollToSection('how-it-works')">How It Works</a>
        <a class="nav-link" onclick="scrollToSection('vote')">Vote Priorities</a>
        <a class="nav-link" onclick="scrollToSection('projects')">Projects</a>
        <a class="nav-link" id="adminLink" style="display: none;" onclick="scrollToSection('admin')">Admin</a>
        
        <select id="languageSelect" onchange="changeLanguage()">
            <option value="en">English</option>
            <option value="ta">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç (Tamil)</option>
            <option value="hi">‡§π‡§ø‡§Ç‡§¶‡•Ä (Hindi)</option>
        </select>
        
        <span id="userStatus" class="user-status" style="display: none;"></span>
        <button class="btn btn-secondary" id="loginBtn" onclick="openModal('entryModal')">Login</button>
        <button class="btn btn-danger" id="logoutBtn" onclick="logout()" style="display: none;">Logout</button>
    </div>
</nav>

<!-- HERO SECTION -->
<section class="hero">
    <h1 id="heroTitle">Government Spending, <br><span style="color:var(--brand)">Decoded for You.</span></h1>
    <p id="heroSubtitle">CivicSpend Pro bridges the gap between complex municipal ledgers and citizen understanding. Explore live data, track every rupee, and influence the city's future.</p>
    <div class="cta-group">
        <button class="btn btn-primary" onclick="scrollToSection('dashboard')">Enter Dashboard</button>
        <button class="btn btn-secondary" onclick="scrollToSection('how-it-works')">Learn More</button>
    </div>
</section>

<!-- MAIN DASHBOARD -->
<div class="dashboard-container" id="dashboard">
    <!-- LEFT COLUMN - MAIN CONTENT -->
    <main>
        <!-- BUDGET CHART CARD -->
        <div class="card">
            <div class="data-freshness" id="dataFreshness">Data synced 2h ago</div>
            <span class="badge badge-blue">Live Expenditure Stream</span>
            <h2 id="chartTitle">Current Resource Allocation</h2>
            <p id="chartDesc" style="color: var(--slate-600); margin-bottom: 30px; line-height: 1.6;">
                This chart represents the <strong>validated treasury data</strong> for the fiscal year 2024-25. Data is updated in real-time.
            </p>
            <div id="main_chart" style="height: 400px; width: 100%;"></div>
            
            <div class="download-btns">
                <button class="btn" onclick="downloadCSV()">üì• Download CSV</button>
                <button class="btn" onclick="downloadJSON()">üì• Download JSON</button>
                <button class="btn" onclick="downloadPDF()">üì• Download PDF</button>
            </div>
        </div>

        <!-- PUBLIC VOTE STATS -->
        <div class="card">
            <span class="badge badge-orange">Public Sentiment</span>
            <h3 id="publicStatsTitle">Live Voting Stats</h3>
            <p id="publicStatsDesc" style="color: var(--slate-600); margin-top:0;">Aggregated stats only (no personal details).</p>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="publicTotalVotes">0</div>
                    <div id="publicTotalVotesLabel">Total votes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="publicTodayVotes">0</div>
                    <div id="publicTodayVotesLabel">Votes today</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="publicAvgEducation">0%</div>
                    <div id="publicAvgEducationLabel">Avg Education</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="publicAvgInfra">0%</div>
                    <div id="publicAvgInfraLabel">Avg Infrastructure</div>
                </div>
            </div>
            
            <div class="vote-demographics">
                <div>
                    <h5 id="publicAgeTitle">Age groups</h5>
                    <div id="publicAgeChart" class="demographic-chart"></div>
                </div>
                <div>
                    <h5 id="publicGenderTitle">Gender</h5>
                    <div id="publicGenderChart" class="demographic-chart"></div>
                </div>
            </div>
        </div>
    </main>

    <!-- RIGHT COLUMN - VOTING SIDEBAR -->
    <aside id="vote">
        <div class="card">
            <span class="badge badge-green">Citizen Input Portal</span>
            <h3 id="voteTitle">Voice Your Priorities</h3>
            
            <!-- Login Prompt -->
            <div id="login_prompt" style="text-align: center; padding: 20px 0;">
                <p id="loginPromptText" style="font-size: 0.9rem; color: var(--slate-600);">Verify your identity via SMS to vote.</p>
                <button class="btn btn-primary" onclick="openModal('userLoginModal')" style="width:100%; margin-top: 20px;">Login to Vote</button>
            </div>

            <!-- Voting Controls -->
            <div id="voting_controls" style="display: none;">
                <p id="user_welcome" style="font-size: 0.85rem; font-weight: 700; color: var(--brand); margin-bottom: 20px; padding: 10px; background: var(--brand-soft); border-radius: 8px;"></p>
                
                <div style="margin-bottom: 25px;">
                    <h4 style="margin-bottom: 15px;">Your Profile</h4>
                    <select id="genderSelect" style="margin-bottom: 10px;">
                        <option value="">Select Gender</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                        <option value="other">Other</option>
                    </select>
                    <select id="ageGroupSelect" style="margin-bottom: 10px;">
                        <option value="">Select Age Group</option>
                        <option value="18-25">18-25</option>
                        <option value="26-35">26-35</option>
                        <option value="36-50">36-50</option>
                        <option value="50+">50+</option>
                    </select>
                    <select id="wardSelect">
                        <option value="">Select Your Ward</option>
                        <option value="Ward 1">Ward 1</option>
                        <option value="Ward 2">Ward 2</option>
                        <option value="Ward 3">Ward 3</option>
                        <option value="Ward 4">Ward 4</option>
                        <option value="Ward 5">Ward 5</option>
                    </select>
                </div>

                <h4>Allocate Budget Priorities</h4>
                <p style="font-size: 0.85rem; color: var(--slate-600); margin-bottom: 20px;">Drag sliders to allocate percentage to each category (Total must be 100%)</p>
                
                <div class="slider-container">
                    <label id="eduLabel">Education: <span id="val1">25</span>%</label>
                    <input type="range" id="edu_p" value="25" min="0" max="100" oninput="updateSlider('val1', this.value); updateTotal()">
                </div>
                
                <div class="slider-container">
                    <label id="infLabel">Infrastructure: <span id="val2">25</span>%</label>
                    <input type="range" id="inf_p" value="25" min="0" max="100" oninput="updateSlider('val2', this.value); updateTotal()">
                </div>
                
                <div class="slider-container">
                    <label id="healthLabel">Healthcare: <span id="val3">25</span>%</label>
                    <input type="range" id="health_p" value="25" min="0" max="100" oninput="updateSlider('val3', this.value); updateTotal()">
                </div>
                
                <div class="slider-container">
                    <label id="sanLabel">Sanitation: <span id="val4">25</span>%</label>
                    <input type="range" id="san_p" value="25" min="0" max="100" oninput="updateSlider('val4', this.value); updateTotal()">
                </div>
                
                <div style="margin: 20px 0; padding: 10px; background: #f0f9ff; border-radius: 8px;">
                    <strong>Total: <span id="totalPercentage">100</span>%</strong>
                </div>

                <textarea id="voteReason" placeholder="Why do you prioritize these areas? (Optional)" 
                          style="width:100%; padding:12px; border-radius:8px; border:1px solid #ddd; margin-bottom:15px; resize:vertical; min-height:80px;"></textarea>
                
                <div style="display: flex; gap: 10px; margin-top: 15px; align-items: center;">
                    <input type="checkbox" id="followUpdates" checked>
                    <label for="followUpdates" style="font-size: 0.85rem; color: var(--slate-600);">Send me updates on budget decisions</label>
                </div>
                
                <button class="btn btn-primary" style="width:100%; margin-top:20px;" onclick="submitVote()">Submit Priority Vote</button>
            </div>

            <!-- Already Voted Message -->
            <div id="already_voted" style="display: none; text-align: center; padding: 20px;">
                <div style="font-size: 3rem; margin-bottom: 10px;">‚úÖ</div>
                <h4 id="votedTitle">Identity Verified</h4>
                <p id="votedSubtitle" style="font-size: 0.85rem; color: var(--slate-600);">Your vote is securely recorded.</p>
                <button class="btn btn-secondary" style="width:100%; margin-top:10px;" onclick="logout()">Sign Out</button>
            </div>

            <!-- Admin Dashboard -->
            <div id="adminDashboard">
                <div class="admin-section">
                    <h4>üõ°Ô∏è Admin Dashboard</h4>
                    <div class="stats-grid">
                        <div class="stat-card"><div class="stat-number" id="totalVotes">0</div><div>Total Votes</div></div>
                        <div class="stat-card"><div class="stat-number" id="todayVotes">0</div><div>Today's Votes</div></div>
                        <div class="stat-card"><div class="stat-number" id="maleVotes">0</div><div>Male Voters</div></div>
                        <div class="stat-card"><div class="stat-number" id="femaleVotes">0</div><div>Female Voters</div></div>
                    </div>
                    
                    <div class="vote-demographics">
                        <div><h5>Age Distribution</h5><div id="ageChart" class="demographic-chart"></div></div>
                        <div><h5>Gender Distribution</h5><div id="genderChart" class="demographic-chart"></div></div>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <h5>Average Priorities</h5>
                        <div id="avgPriorities" style="background: #f8fafc; padding: 15px; border-radius: 8px;">
                            <div>Education: <span id="avgEdu">0%</span></div>
                            <div>Infrastructure: <span id="avgInfra">0%</span></div>
                            <div>Healthcare: <span id="avgHealth">0%</span></div>
                            <div>Sanitation: <span id="avgSan">0%</span></div>
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" style="width:100%; margin-top:20px;" onclick="exportVoteData()">üìä Export Vote Data</button>
                </div>
            </div>
        </div>
    </aside>
</div>

<!-- PROJECTS MAP SECTION -->
<section class="section" id="projects">
    <div class="section-title">
        <span class="badge badge-blue">Real World Impact</span>
        <h2 id="projectsTitle">Infrastructure Projects Map</h2>
        <p id="projectsSubtitle" style="color:var(--slate-600); max-width:600px; margin: 15px auto;">Click on markers to see project details and report issues.</p>
    </div>
    <div class="card" style="max-width: 1200px; margin: 0 auto;">
        <div id="project-map"></div>
        <div style="margin-top: 20px; display: flex; gap: 20px; flex-wrap: wrap;">
            <div>
                <h5>Filter by Ward:</h5>
                <select id="wardFilter" onchange="filterMapByWard()">
                    <option value="all">All Wards</option>
                    <option value="1">Ward 1</option>
                    <option value="2">Ward 2</option>
                    <option value="3">Ward 3</option>
                    <option value="4">Ward 4</option>
                    <option value="5">Ward 5</option>
                </select>
            </div>
            <div>
                <h5>Filter by Status:</h5>
                <select id="statusFilter" onchange="filterMapByStatus()">
                    <option value="all">All Status</option>
                    <option value="completed">Completed</option>
                    <option value="progress">In Progress</option>
                    <option value="planned">Planned</option>
                </select>
            </div>
        </div>
    </div>
</section>

<!-- HOW IT WORKS SECTION -->
<section class="section" id="how-it-works">
    <div class="section-title">
        <span class="badge badge-blue">Process Transparency</span>
        <h2 id="howTitle">How CivicSpend Works</h2>
    </div>
    <div class="grid-3">
        <div class="step-card">
            <div class="step-num">01</div>
            <h4 id="step1Title">Data Ingestion</h4>
            <p id="step1Desc">Connect to Municipal Financial Management System, pulling expenditure data every 24 hours.</p>
        </div>
        <div class="step-card">
            <div class="step-num">02</div>
            <h4 id="step2Title">Visualization</h4>
            <p id="step2Desc">Convert complex data into intuitive charts for easy citizen understanding.</p>
        </div>
        <div class="step-card">
            <div class="step-num">03</div>
            <h4 id="step3Title">Public Feedback</h4>
            <p id="step3Desc">Citizens vote on priorities using secure, verified voting system.</p>
        </div>
    </div>
</section>

<!-- FAQ SECTION -->
<section class="section">
    <div class="section-title">
        <span class="badge badge-blue">Resources</span>
        <h2 id="faqTitle">Common Questions</h2>
    </div>
    <div class="accordion">
        <div class="accordion-item">
            <div class="accordion-header" onclick="toggleAccordion(this)">
                <span id="faq1">Where does this data come from?</span>
                <span>+</span>
            </div>
            <div class="accordion-content">
                <span id="faq1a">Our data comes from the Municipal Corporation's Open Data portal, updated quarterly.</span>
            </div>
        </div>
        <div class="accordion-item">
            <div class="accordion-header" onclick="toggleAccordion(this)">
                <span id="faq2">How secure is my vote?</span>
                <span>+</span>
            </div>
            <div class="accordion-content">
                <span id="faq2a">Votes are cryptographically signed and stored against your verified phone number.</span>
            </div>
        </div>
        <div class="accordion-item">
            <div class="accordion-header" onclick="toggleAccordion(this)">
                <span id="faq3">Can I change my vote?</span>
                <span>+</span>
            </div>
            <div class="accordion-content">
                <span id="faq3a">One vote per verified number per budget cycle.</span>
            </div>
        </div>
    </div>
</section>

<!-- CHATBOT -->
<div id="chatbot">
    <button class="btn btn-primary" onclick="toggleChatbot()" style="border-radius:999px; padding:12px 18px; box-shadow:0 4px 12px rgba(37,99,235,0.3);">
        üí¨ Civic Assistant
    </button>
    <div id="chatbotPanel">
        <div style="padding:14px 16px; background:var(--brand); color:white; display:flex; justify-content:space-between; align-items:center;">
            <div style="font-weight:800;">CivicSpend Assistant</div>
            <button onclick="toggleChatbot()" style="background:transparent; border:none; color:white; font-size:18px; cursor:pointer;">‚úï</button>
        </div>
        <div id="chatMessages" style="padding:14px; height:300px; overflow:auto; background:#f8fafc;">
            <div style="margin-bottom:10px; background:#eff6ff; padding:10px; border-radius:8px;">
                <strong>Bot:</strong> Hello! I'm your CivicSpend assistant. Ask me about budget, voting, or projects.
            </div>
        </div>
        <div style="padding:12px; display:flex; gap:8px; border-top:1px solid #e2e8f0;">
            <input id="chatInput" type="text" placeholder="Ask about budget..." 
                   style="flex:1; padding:10px; border-radius:10px; border:1px solid #e2e8f0;" 
                   onkeypress="if(event.key === 'Enter') sendChat()">
            <button class="btn btn-primary" style="padding:10px 14px; border-radius:10px;" onclick="sendChat()">Send</button>
        </div>
    </div>
</div>

<!-- FOOTER -->
<footer>
    <div class="footer-grid">
        <div>
            <h3 style="color:white; margin-bottom: 1.5rem;">üèôÔ∏è CivicSpend</h3>
            <p style="font-size: 0.9rem; color: #94a3b8; line-height: 1.6;">Making municipal finance accessible for every citizen.</p>
        </div>
        <div>
            <h4>Links</h4>
            <a href="#">Audit Documentation</a>
            <a href="#">Privacy Policy</a>
            <a href="#">API Access</a>
        </div>
        <div>
            <h4>Contact</h4>
            <a>üìß support@civicspend.gov</a>
            <a>üìç Finance Dept, City Hall</a>
            <a>üìû +91 44 2345 6789</a>
        </div>
        <div>
            <h4>Quick Links</h4>
            <a onclick="scrollToSection('dashboard')">Dashboard</a>
            <a onclick="scrollToSection('vote')">Vote Now</a>
            <a onclick="scrollToSection('projects')">Project Map</a>
            <a onclick="scrollToSection('how-it-works')">How It Works</a>
        </div>
    </div>
    <div class="footer-bottom">
        ¬© 2024 CivicSpend Pro. Built with Firebase & Google Charts.
    </div>
</footer>

<!-- Toast Notification -->
<div id="toast" class="toast"></div>

<script>
    // =====================
    // FIREBASE CONFIGURATION
    // =====================
    const firebaseConfig = {
        apiKey: "AIzaSyB6lFVx7NFFDlLzS5bp4f-_B9fqfW1cT-Y",
        authDomain: "civicspend-pro.firebaseapp.com",
        projectId: "civicspend-pro",
        storageBucket: "civicspend-pro.firebasestorage.app",
        messagingSenderId: "123456789012",
        appId: "1:123456789012:web:abcdef1234567890"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // =====================
    // GLOBAL VARIABLES
    // =====================
    let currentUser = null;
    let isAdmin = false;
    let currentLanguage = 'en';
    let map = null;
    let mapMarkers = [];
    let userVotes = [];

    // =====================
    // INITIALIZATION
    // =====================
    document.addEventListener('DOMContentLoaded', function() {
        initializeApp();
    });

    async function initializeApp() {
        try {
            // Hide loading screen after 1.5 seconds
            setTimeout(() => {
                document.getElementById('loadingScreen').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('loadingScreen').style.display = 'none';
                }, 300);
            }, 1500);

            // Initialize Google Charts
            google.charts.load('current', {'packages':['corechart']});
            google.charts.setOnLoadCallback(initializeCharts);
            
            // Check for existing auth state
            auth.onAuthStateChanged(async (user) => {
                if (user) {
                    currentUser = user;
                    isAdmin = await checkIfAdmin(user.uid);
                    showToast(`Welcome back ${isAdmin ? 'Admin' : 'User'}!`, 'success');
                } else {
                    currentUser = null;
                    isAdmin = false;
                }
                updateUI();
                loadData();
                checkUserVote();
            });

            // Initialize map
            initMap();
            
            // Load initial data
            await loadVotes();
            loadLedgerData();
            
            // Show entry modal for new visitors
            if (!localStorage.getItem('hasVisited')) {
                setTimeout(() => {
                    openModal('entryModal');
                    localStorage.setItem('hasVisited', 'true');
                }, 2000);
            }

        } catch (error) {
            console.error('Initialization error:', error);
            showToast('Error loading application', 'error');
        }
    }

    function initializeCharts() {
        // Initialize charts with some default data
        updateCharts({ '18-25': 0, '26-35': 0, '36-50': 0, '50+': 0 }, { 'male': 0, 'female': 0, 'other': 0 });
    }

    // =====================
    // AUTHENTICATION FUNCTIONS
    // =====================
    function chooseEntry(type) {
        closeModal('entryModal');
        if (type === 'user') {
            openModal('userLoginModal');
        } else if (type === 'admin') {
            openModal('adminLoginModal');
        }
    }

    function enterAsGuest() {
        closeModal('entryModal');
        currentUser = null;
        isAdmin = false;
        updateUI();
        showToast('Browsing as guest', 'success');
    }

    async function sendOTP() {
        const phoneNumber = document.getElementById('phoneNumber').value;
        if (!phoneNumber || phoneNumber.length !== 10) {
            showToast('Please enter a valid 10-digit phone number', 'error');
            return;
        }

        // For demo, we'll simulate OTP sending
        document.getElementById('userLoginForm').style.display = 'none';
        document.getElementById('otpContainer').style.display = 'block';
        showToast('OTP sent to ' + phoneNumber + ' (Demo: 123456)', 'success');
    }

    async function verifyOTP() {
        const otp = document.getElementById('verificationCode').value;
        const phoneNumber = document.getElementById('phoneNumber').value;

        if (otp !== '123456') {
            showToast('Invalid OTP. Use 123456 for demo', 'error');
            return;
        }

        try {
            // Create email from phone number for Firebase authentication
            const email = phoneNumber + '@civicspend.demo';
            const password = 'demo123';
            
            // Try to sign in with the generated credentials
            try {
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                currentUser = userCredential.user;
            } catch (signInError) {
                // If user doesn't exist, create a new one
                if (signInError.code === 'auth/user-not-found') {
                    const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                    currentUser = userCredential.user;
                    
                    // Update profile with phone number
                    await currentUser.updateProfile({
                        displayName: 'User-' + phoneNumber
                    });
                } else {
                    throw signInError;
                }
            }

            // Store user data in Firestore
            await db.collection('users').doc(currentUser.uid).set({
                phone: phoneNumber,
                email: email,
                isAdmin: false,
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                lastLogin: firebase.firestore.FieldValue.serverTimestamp()
            }, { merge: true });

            closeModal('userLoginModal');
            showToast('Login successful!', 'success');
            
        } catch (error) {
            console.error('Login error:', error);
            showToast('Login failed. Please try again.', 'error');
        }
    }

    async function adminLogin() {
        const email = document.getElementById('adminEmail').value || 'admin@civicspend.demo';
        const password = document.getElementById('adminPassword').value || 'admin123';

        try {
            let userCredential;
            
            try {
                userCredential = await auth.signInWithEmailAndPassword(email, password);
            } catch (signInError) {
                // If admin doesn't exist, create one
                if (signInError.code === 'auth/user-not-found') {
                    userCredential = await auth.createUserWithEmailAndPassword(email, password);
                } else {
                    throw signInError;
                }
            }

            // Set as admin in Firestore
            await db.collection('users').doc(userCredential.user.uid).set({
                email: email,
                isAdmin: true,
                lastLogin: firebase.firestore.FieldValue.serverTimestamp(),
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            }, { merge: true });

            currentUser = userCredential.user;
            isAdmin = true;
            
            closeModal('adminLoginModal');
            showToast('Admin login successful!', 'success');
            
        } catch (error) {
            console.error('Admin login error:', error);
            showToast('Login failed. Please try again.', 'error');
        }
    }

    async function checkIfAdmin(uid) {
        try {
            const userDoc = await db.collection('users').doc(uid).get();
            return userDoc.exists && userDoc.data().isAdmin === true;
        } catch (error) {
            console.error('Error checking admin status:', error);
            return false;
        }
    }

    async function logout() {
        try {
            await auth.signOut();
            currentUser = null;
            isAdmin = false;
            updateUI();
            showToast('Logged out successfully', 'success');
        } catch (error) {
            showToast('Logout failed', 'error');
        }
    }

    // =====================
    // VOTING SYSTEM
    // =====================
    async function submitVote() {
        if (!currentUser || isAdmin) {
            showToast('Please login as a regular user to vote', 'error');
            return;
        }

        const gender = document.getElementById('genderSelect').value;
        const ageGroup = document.getElementById('ageGroupSelect').value;
        const ward = document.getElementById('wardSelect').value;

        if (!gender || !ageGroup || !ward) {
            showToast('Please select gender, age group, and ward', 'error');
            return;
        }

        // Check total percentage
        const total = parseInt(document.getElementById('totalPercentage').textContent);
        if (total !== 100) {
            showToast('Total must be 100%. Current total: ' + total + '%', 'error');
            return;
        }

        // Check if user already voted
        const existingVote = await db.collection('votes')
            .where('userId', '==', currentUser.uid)
            .limit(1)
            .get();

        if (!existingVote.empty) {
            showToast('You have already voted!', 'error');
            document.getElementById('voting_controls').style.display = 'none';
            document.getElementById('already_voted').style.display = 'block';
            return;
        }

        const voteData = {
            userId: currentUser.uid,
            phone: currentUser.email ? currentUser.email.split('@')[0] : '',
            gender: gender,
            ageGroup: ageGroup,
            ward: ward,
            education: parseInt(document.getElementById('edu_p').value),
            infrastructure: parseInt(document.getElementById('inf_p').value),
            healthcare: parseInt(document.getElementById('health_p').value),
            sanitation: parseInt(document.getElementById('san_p').value),
            reason: document.getElementById('voteReason').value || '',
            followUpdates: document.getElementById('followUpdates').checked,
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
        };

        try {
            await db.collection('votes').add(voteData);
            showToast('Vote submitted successfully! Thank you for participating.', 'success');
            
            // Update UI
            document.getElementById('voting_controls').style.display = 'none';
            document.getElementById('already_voted').style.display = 'block';
            
            // Reload data
            await loadVotes();
            
        } catch (error) {
            console.error('Vote submission error:', error);
            showToast('Failed to submit vote. Please try again.', 'error');
        }
    }

    async function loadVotes() {
        try {
            const snapshot = await db.collection('votes').get();
            userVotes = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            updateVoteStats();
        } catch (error) {
            console.error('Error loading votes:', error);
        }
    }

    function updateVoteStats() {
        const today = new Date().toDateString();
        const todayVotes = userVotes.filter(v => {
            const voteDate = v.timestamp?.toDate ? v.timestamp.toDate().toDateString() : new Date().toDateString();
            return voteDate === today;
        });

        const ageCounts = { '18-25': 0, '26-35': 0, '36-50': 0, '50+': 0 };
        const genderCounts = { 'male': 0, 'female': 0, 'other': 0 };
        let totalEdu = 0, totalInfra = 0, totalHealth = 0, totalSan = 0;

        userVotes.forEach(vote => {
            if (vote.ageGroup && ageCounts[vote.ageGroup] !== undefined) {
                ageCounts[vote.ageGroup]++;
            }
            if (vote.gender && genderCounts[vote.gender] !== undefined) {
                genderCounts[vote.gender]++;
            }
            if (vote.education) totalEdu += vote.education;
            if (vote.infrastructure) totalInfra += vote.infrastructure;
            if (vote.healthcare) totalHealth += vote.healthcare;
            if (vote.sanitation) totalSan += vote.sanitation;
        });

        // Update public stats
        document.getElementById('publicTotalVotes').textContent = userVotes.length;
        document.getElementById('publicTodayVotes').textContent = todayVotes.length;
        
        if (userVotes.length > 0) {
            document.getElementById('publicAvgEducation').textContent = Math.round(totalEdu / userVotes.length) + '%';
            document.getElementById('publicAvgInfra').textContent = Math.round(totalInfra / userVotes.length) + '%';
        }

        // Update admin stats
        if (isAdmin) {
            document.getElementById('totalVotes').textContent = userVotes.length;
            document.getElementById('todayVotes').textContent = todayVotes.length;
            document.getElementById('maleVotes').textContent = genderCounts.male;
            document.getElementById('femaleVotes').textContent = genderCounts.female;
            
            if (userVotes.length > 0) {
                document.getElementById('avgEdu').textContent = Math.round(totalEdu / userVotes.length) + '%';
                document.getElementById('avgInfra').textContent = Math.round(totalInfra / userVotes.length) + '%';
                document.getElementById('avgHealth').textContent = Math.round(totalHealth / userVotes.length) + '%';
                document.getElementById('avgSan').textContent = Math.round(totalSan / userVotes.length) + '%';
            }

            // Update charts
            updateCharts(ageCounts, genderCounts);
        }
    }

    // =====================
    // UI FUNCTIONS
    // =====================
    function updateUI() {
        const loginBtn = document.getElementById('loginBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const userStatus = document.getElementById('userStatus');
        const adminLink = document.getElementById('adminLink');
        const adminDashboard = document.getElementById('adminDashboard');

        if (currentUser) {
            loginBtn.style.display = 'none';
            logoutBtn.style.display = 'block';
            userStatus.style.display = 'flex';
            
            if (isAdmin) {
                userStatus.innerHTML = `<span class="admin-badge">ADMIN</span> ${currentUser.email || 'Admin'}`;
                adminLink.style.display = 'block';
                adminDashboard.style.display = 'block';
                
                // Hide voting interface for admin
                document.getElementById('login_prompt').style.display = 'none';
                document.getElementById('voting_controls').style.display = 'none';
                document.getElementById('already_voted').style.display = 'none';
            } else {
                userStatus.textContent = `üë§ ${currentUser.email ? currentUser.email.split('@')[0] : 'User'}`;
                adminLink.style.display = 'none';
                adminDashboard.style.display = 'none';
            }
        } else {
            loginBtn.style.display = 'block';
            logoutBtn.style.display = 'none';
            userStatus.style.display = 'none';
            adminLink.style.display = 'none';
            adminDashboard.style.display = 'none';
            
            // Show login prompt
            document.getElementById('login_prompt').style.display = 'block';
            document.getElementById('voting_controls').style.display = 'none';
            document.getElementById('already_voted').style.display = 'none';
        }
    }

    async function checkUserVote() {
        if (!currentUser || isAdmin) return;
        
        try {
            const existingVote = await db.collection('votes')
                .where('userId', '==', currentUser.uid)
                .limit(1)
                .get();

            if (!existingVote.empty) {
                document.getElementById('voting_controls').style.display = 'none';
                document.getElementById('already_voted').style.display = 'block';
                document.getElementById('login_prompt').style.display = 'none';
            } else {
                document.getElementById('user_welcome').textContent = `Welcome ${currentUser.email ? currentUser.email.split('@')[0] : 'User'}! Set your priorities.`;
                document.getElementById('login_prompt').style.display = 'none';
                document.getElementById('voting_controls').style.display = 'block';
                document.getElementById('already_voted').style.display = 'none';
            }
        } catch (error) {
            console.error('Error checking user vote:', error);
        }
    }

    function updateSlider(id, value) {
        document.getElementById(id).textContent = value;
    }

    function updateTotal() {
        const edu = parseInt(document.getElementById('edu_p').value);
        const inf = parseInt(document.getElementById('inf_p').value);
        const health = parseInt(document.getElementById('health_p').value);
        const san = parseInt(document.getElementById('san_p').value);
        const total = edu + inf + health + san;
        document.getElementById('totalPercentage').textContent = total;
    }

    // =====================
    // MAP FUNCTIONS
    // =====================
    function initMap() {
        if (!document.getElementById('project-map')) return;
        
        map = L.map('project-map').setView([12.9716, 77.5946], 13);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap contributors'
        }).addTo(map);

        const projects = [
            { lat: 12.9716, lng: 77.5946, title: 'Smart School', desc: 'Digital literacy wing', ward: 'Ward 5', status: 'completed', amount: '‚Çπ2.5 Cr' },
            { lat: 12.9816, lng: 77.5846, title: 'Metro Expansion', desc: 'New metro line', ward: 'Ward 3', status: 'progress', amount: '‚Çπ15 Cr' },
            { lat: 12.9616, lng: 77.6046, title: 'Waste Plant', desc: 'Recycling facility', ward: 'Ward 2', status: 'planned', amount: '‚Çπ8 Cr' },
            { lat: 12.9766, lng: 77.5996, title: 'Public Park', desc: 'Green space', ward: 'Ward 4', status: 'progress', amount: '‚Çπ3.2 Cr' },
            { lat: 12.9666, lng: 77.5896, title: 'Water Pipeline', desc: 'Pipeline upgrade', ward: 'Ward 1', status: 'completed', amount: '‚Çπ4.5 Cr' }
        ];

        projects.forEach(project => {
            let color = 'blue';
            if (project.status === 'completed') color = 'green';
            if (project.status === 'progress') color = 'orange';
            if (project.status === 'planned') color = 'gray';

            const marker = L.marker([project.lat, project.lng], {
                icon: L.divIcon({
                    className: 'custom-icon',
                    html: `<div style="background:${color}; width:20px; height:20px; border-radius:50%; border:2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.3);"></div>`
                })
            }).addTo(map);

            marker.bindPopup(`
                <b>${project.title}</b><br>
                ${project.desc}<br>
                <strong>Ward:</strong> ${project.ward}<br>
                <strong>Status:</strong> ${project.status}<br>
                <strong>Budget:</strong> ${project.amount}<br>
                <button onclick="reportIssue('${project.title}')" class="btn" style="margin-top:5px; padding:5px 10px; background:var(--danger); color:white; border:none; border-radius:4px; cursor:pointer; font-size:12px;">
                    Report Issue
                </button>
            `);

            mapMarkers.push({ marker, project });
        });
    }

    function filterMapByWard() {
        const ward = document.getElementById('wardFilter').value;
        mapMarkers.forEach(item => {
            if (ward === 'all' || item.project.ward.includes(ward)) {
                item.marker.addTo(map);
            } else {
                map.removeLayer(item.marker);
            }
        });
    }

    function filterMapByStatus() {
        const status = document.getElementById('statusFilter').value;
        mapMarkers.forEach(item => {
            if (status === 'all' || item.project.status === status) {
                item.marker.addTo(map);
            } else {
                map.removeLayer(item.marker);
            }
        });
    }

    function reportIssue(projectTitle) {
        if (!currentUser) {
            showToast('Please login to report an issue', 'error');
            return;
        }
        const issue = prompt(`Describe the issue with ${projectTitle}:`);
        if (issue) {
            // Save issue to Firestore
            db.collection('reports').add({
                project: projectTitle,
                issue: issue,
                userId: currentUser.uid,
                timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                status: 'pending'
            });
            showToast('Issue reported successfully!', 'success');
        }
    }

    // =====================
    // CHART FUNCTIONS
    // =====================
    function updateCharts(ageCounts, genderCounts) {
        // Age Chart
        const ageData = google.visualization.arrayToDataTable([
            ['Age', 'Votes'],
            ['18-25', ageCounts['18-25']],
            ['26-35', ageCounts['26-35']],
            ['36-50', ageCounts['36-50']],
            ['50+', ageCounts['50+']]
        ]);

        const ageOptions = {
            title: 'Age Distribution',
            backgroundColor: 'transparent',
            colors: ['#2563eb', '#10b981', '#f59e0b', '#ef4444'],
            pieHole: 0.4
        };

        if (document.getElementById('ageChart')) {
            new google.visualization.PieChart(document.getElementById('ageChart'))
                .draw(ageData, ageOptions);
        }

        if (document.getElementById('publicAgeChart')) {
            new google.visualization.ColumnChart(document.getElementById('publicAgeChart'))
                .draw(ageData, { ...ageOptions, title: '' });
        }

        // Gender Chart
        const genderData = google.visualization.arrayToDataTable([
            ['Gender', 'Votes'],
            ['Male', genderCounts['male']],
            ['Female', genderCounts['female']],
            ['Other', genderCounts['other'] || 0]
        ]);

        const genderOptions = {
            backgroundColor: 'transparent',
            colors: ['#2563eb', '#10b981', '#f59e0b'],
            pieHole: 0.4
        };

        if (document.getElementById('genderChart')) {
            new google.visualization.PieChart(document.getElementById('genderChart'))
                .draw(genderData, { ...genderOptions, title: 'Gender Distribution' });
        }

        if (document.getElementById('publicGenderChart')) {
            new google.visualization.PieChart(document.getElementById('publicGenderChart'))
                .draw(genderData, { ...genderOptions, title: '' });
        }

        // Main Budget Chart
        const budgetData = google.visualization.arrayToDataTable([
            ['Category', 'Amount (‚Çπ Cr)'],
            ['Education', 45],
            ['Healthcare', 32],
            ['Infrastructure', 58],
            ['Sanitation', 25]
        ]);

        if (document.getElementById('main_chart')) {
            new google.visualization.PieChart(document.getElementById('main_chart')).draw(budgetData, {
                pieHole: 0.6,
                chartArea: { width: '90%', height: '80%' },
                legend: { position: 'bottom' },
                backgroundColor: 'transparent',
                colors: ['#2563eb', '#10b981', '#f59e0b', '#ef4444']
            });
        }
    }

    // =====================
    // UTILITY FUNCTIONS
    // =====================
    function scrollToSection(sectionId) {
        const element = document.getElementById(sectionId);
        if (element) {
            element.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
    }

    function openModal(modalId) {
        const modal = document.getElementById(modalId);
        modal.classList.add('show');
    }

    function closeModal(modalId) {
        const modal = document.getElementById(modalId);
        modal.classList.remove('show');
    }

    function toggleAccordion(header) {
        const content = header.nextElementSibling;
        content.classList.toggle('active');
        header.lastElementChild.textContent = content.classList.contains('active') ? '‚àí' : '+';
    }

    function showToast(message, type = 'success') {
        const toast = document.getElementById('toast');
        toast.textContent = message;
        toast.className = 'toast ' + (type === 'error' ? 'error' : '');
        toast.classList.add('show');
        
        setTimeout(() => {
            toast.classList.remove('show');
        }, 3000);
    }

    function loadData() {
        updateDataFreshness();
        setInterval(updateDataFreshness, 60000);
        
        // Initialize search
        const searchInput = document.getElementById('ledgerSearch');
        if (searchInput) {
            searchInput.addEventListener('input', function(e) {
                const term = e.target.value.toLowerCase();
                const rows = document.querySelectorAll('#ledgerBody tr');
                rows.forEach(row => {
                    row.style.display = row.textContent.toLowerCase().includes(term) ? '' : 'none';
                });
            });
        }
    }

    function updateDataFreshness() {
        const hours = Math.floor(Math.random() * 6);
        document.getElementById('dataFreshness').textContent = `Data synced ${hours}h ago`;
    }

    function loadLedgerData() {
        const tbody = document.getElementById('ledgerBody');
        if (!tbody) return;
        
        const data = [
            ['2024-03-15', 'Education', 'Smart School Project', '‚Çπ2,50,00,000', 'Ward 5', 'ABC Constructions', 'Completed'],
            ['2024-03-14', 'Healthcare', 'Primary Health Center', '‚Çπ1,80,00,000', 'Ward 7', 'MediCare Builders', 'In Progress'],
            ['2024-03-13', 'Infrastructure', 'Road Widening', '‚Çπ3,20,00,000', 'Ward 3', 'Roads India Ltd', 'Completed'],
            ['2024-03-12', 'Sanitation', 'Sewage Treatment Plant', '‚Çπ4,50,00,000', 'Ward 9', 'CleanWater Tech', 'Planned']
        ];
        
        tbody.innerHTML = data.map(row => `
            <tr>
                <td>${row[0]}</td>
                <td>${row[1]}</td>
                <td>${row[2]}</td>
                <td>${row[3]}</td>
                <td>${row[4]}</td>
                <td>${row[5]}</td>
                <td><span style="padding:4px 8px; border-radius:4px; background:#dcfce7; color:#166534; font-size:0.8rem;">${row[6]}</span></td>
            </tr>
        `).join('');
    }

    // =====================
    // DOWNLOAD FUNCTIONS
    // =====================
    function downloadCSV() {
        const csv = 'Date,Category,Description,Amount,Ward,Vendor,Status\n' +
                   '2024-03-15,Education,Smart School Project,25000000,Ward 5,ABC Constructions,Completed\n' +
                   '2024-03-14,Healthcare,Primary Health Center,18000000,Ward 7,MediCare Builders,In Progress\n' +
                   '2024-03-13,Infrastructure,Road Widening,32000000,Ward 3,Roads India Ltd,Completed\n' +
                   '2024-03-12,Sanitation,Sewage Treatment Plant,45000000,Ward 9,CleanWater Tech,Planned';
        
        const blob = new Blob([csv], {type: 'text/csv'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'civicspend_ledger.csv';
        a.click();
        showToast('CSV download started', 'success');
    }

    function downloadJSON() {
        const data = {
            ledger: [
                { date: '2024-03-15', category: 'Education', description: 'Smart School Project', amount: 25000000, ward: 'Ward 5', vendor: 'ABC Constructions', status: 'Completed' },
                { date: '2024-03-14', category: 'Healthcare', description: 'Primary Health Center', amount: 18000000, ward: 'Ward 7', vendor: 'MediCare Builders', status: 'In Progress' },
                { date: '2024-03-13', category: 'Infrastructure', description: 'Road Widening', amount: 32000000, ward: 'Ward 3', vendor: 'Roads India Ltd', status: 'Completed' },
                { date: '2024-03-12', category: 'Sanitation', description: 'Sewage Treatment Plant', amount: 45000000, ward: 'Ward 9', vendor: 'CleanWater Tech', status: 'Planned' }
            ]
        };
        
        const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'civicspend_data.json';
        a.click();
        showToast('JSON download started', 'success');
    }

    function downloadPDF() {
        showToast('PDF generation feature coming soon!', 'success');
    }

    async function exportVoteData() {
        if (!isAdmin) {
            showToast('Admin access required', 'error');
            return;
        }
        
        try {
            const snapshot = await db.collection('votes').get();
            const votes = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            
            const csv = 'ID,Phone,Gender,AgeGroup,Ward,Education,Infrastructure,Healthcare,Sanitation,Timestamp\n' +
                       votes.map(v => `${v.id},${v.phone || ''},${v.gender},${v.ageGroup},${v.ward},${v.education},${v.infrastructure},${v.healthcare},${v.sanitation},${v.timestamp?.toDate?.() || new Date()}`).join('\n');
            
            const blob = new Blob([csv], {type: 'text/csv'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `votes_export_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            showToast('Vote data exported successfully', 'success');
        } catch (error) {
            console.error('Export error:', error);
            showToast('Export failed', 'error');
        }
    }

    // =====================
    // CHATBOT FUNCTIONS
    // =====================
    function toggleChatbot() {
        const panel = document.getElementById('chatbotPanel');
        panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
    }

    function sendChat() {
        const input = document.getElementById('chatInput');
        const message = input.value.trim();
        if (!message) return;

        const chatMessages = document.getElementById('chatMessages');
        
        // Add user message
        chatMessages.innerHTML += `<div style="margin-bottom:10px;"><strong>You:</strong> ${message}</div>`;
        input.value = '';
        
        // Generate response
        const response = generateBotResponse(message);
        
        // Add bot response
        setTimeout(() => {
            chatMessages.innerHTML += `<div style="margin-bottom:10px; background:#eff6ff; padding:10px; border-radius:8px;"><strong>Bot:</strong> ${response}</div>`;
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }, 500);
    }

    function generateBotResponse(message) {
        const lower = message.toLowerCase();
        if (lower.includes('budget')) return "The current budget is ‚Çπ160 Cr across 4 categories. Education gets 28%, Healthcare 20%, Infrastructure 36%, and Sanitation 16%.";
        if (lower.includes('vote')) return "You can vote by logging in with your phone number, then using the sliders to allocate percentages to different categories.";
        if (lower.includes('map')) return "The map shows infrastructure projects. Click markers for details, and filter by ward or status.";
        if (lower.includes('login')) return "Users: Use phone number + OTP '123456'. Admins: Any email/password works.";
        if (lower.includes('admin')) return "Admin dashboard shows voting statistics, demographics, and allows data export.";
        return "I can help with budget info, voting process, project locations, or login help. What would you like to know?";
    }

    // =====================
    // LANGUAGE FUNCTIONS
    // =====================
    const translations = {
        en: {
            heroTitle: "Government Spending, <br><span style='color:var(--brand)'>Decoded for You.</span>",
            heroSubtitle: "CivicSpend Pro bridges the gap between complex municipal ledgers and citizen understanding.",
            chartTitle: "Current Resource Allocation",
            voteTitle: "Voice Your Priorities",
            publicStatsTitle: "Live Voting Stats",
            publicStatsDesc: "Aggregated stats only (no personal details).",
            publicTotalVotesLabel: "Total votes",
            publicTodayVotesLabel: "Votes today",
            publicAvgEducationLabel: "Avg Education",
            publicAvgInfraLabel: "Avg Infrastructure",
            publicAgeTitle: "Age groups",
            publicGenderTitle: "Gender",
            projectsTitle: "Infrastructure Projects Map",
            projectsSubtitle: "Click on markers to see project details and report issues.",
            howTitle: "How CivicSpend Works",
            faqTitle: "Common Questions",
            loginPromptText: "Verify your identity via SMS to vote.",
            votedTitle: "Identity Verified",
            votedSubtitle: "Your vote is securely recorded.",
            eduLabel: "Education",
            infLabel: "Infrastructure",
            healthLabel: "Healthcare",
            sanLabel: "Sanitation",
            step1Title: "Data Ingestion",
            step1Desc: "Connect to municipal systems for real-time data.",
            step2Title: "Visualization",
            step2Desc: "Convert data into intuitive charts.",
            step3Title: "Public Feedback",
            step3Desc: "Citizens vote on priorities securely.",
            faq1: "Where does this data come from?",
            faq1a: "Municipal Corporation's Open Data portal.",
            faq2: "How secure is my vote?",
            faq2a: "Cryptographically signed and stored securely.",
            faq3: "Can I change my vote?",
            faq3a: "One vote per number per budget cycle."
        },
        ta: {
            heroTitle: "‡ÆÖ‡Æ∞‡Æö‡ØÅ ‡Æö‡ØÜ‡Æ≤‡Æµ‡ØÅ, <br><span style='color:var(--brand)'>‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡ØÅ‡Æï‡Øç‡Æï‡Ææ‡Æï.</span>",
            heroSubtitle: "CivicSpend Pro ‡Æ®‡Æï‡Æ∞‡Ææ‡Æü‡Øç‡Æö‡Æø ‡Æ§‡Æ∞‡Æµ‡Øà ‡Æé‡Æ≥‡Æø‡Æ§‡Ææ‡Æï‡Øç‡Æï‡ØÅ‡Æï‡Æø‡Æ±‡Æ§‡ØÅ.",
            chartTitle: "‡Æ§‡Æ±‡Øç‡Æ™‡Øã‡Æ§‡Øà‡ÆØ ‡Æ®‡Æø‡Æ§‡Æø ‡Æí‡Æ§‡ØÅ‡Æï‡Øç‡Æï‡ØÄ‡Æü‡ØÅ",
            voteTitle: "‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡ÆÆ‡ØÅ‡Æ©‡Øç‡Æ©‡ØÅ‡Æ∞‡Æø‡ÆÆ‡Øà‡Æï‡Æ≥‡Øç",
            publicStatsTitle: "‡Æ®‡Øá‡Æ∞‡Æü‡Æø ‡Æµ‡Ææ‡Æï‡Øç‡Æï‡ØÅ ‡Æ™‡ØÅ‡Æ≥‡Øç‡Æ≥‡Æø‡Æµ‡Æø‡Æµ‡Æ∞‡Æô‡Øç‡Æï‡Æ≥‡Øç",
            publicStatsDesc: "‡ÆÆ‡Øä‡Æ§‡Øç‡Æ§ ‡Æ™‡ØÅ‡Æ≥‡Øç‡Æ≥‡Æø‡Æµ‡Æø‡Æµ‡Æ∞‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡ÆÆ‡Æü‡Øç‡Æü‡ØÅ‡ÆÆ‡Øç.",
            publicTotalVotesLabel: "‡ÆÆ‡Øä‡Æ§‡Øç‡Æ§ ‡Æµ‡Ææ‡Æï‡Øç‡Æï‡ØÅ‡Æï‡Æ≥‡Øç",
            publicTodayVotesLabel: "‡Æá‡Æ©‡Øç‡Æ±‡Øà‡ÆØ ‡Æµ‡Ææ‡Æï‡Øç‡Æï‡ØÅ‡Æï‡Æ≥‡Øç",
            publicAvgEducationLabel: "‡Æö‡Æ∞‡Ææ‡Æö‡Æ∞‡Æø ‡Æï‡Æ≤‡Øç‡Æµ‡Æø",
            publicAvgInfraLabel: "‡Æö‡Æ∞‡Ææ‡Æö‡Æ∞‡Æø ‡Æâ‡Æ≥‡Øç‡Æï‡Æü‡Øç‡Æü‡ÆÆ‡Øà‡Æ™‡Øç‡Æ™‡ØÅ",
            publicAgeTitle: "‡Æµ‡ÆØ‡Æ§‡ØÅ ‡Æï‡ØÅ‡Æ¥‡ØÅ‡Æï‡Øç‡Æï‡Æ≥‡Øç",
            publicGenderTitle: "‡Æ™‡Ææ‡Æ≤‡Æø‡Æ©‡ÆÆ‡Øç",
            projectsTitle: "‡ÆÆ‡ØÜ‡ÆØ‡Øç‡ÆØ ‡ÆÖ‡Æü‡Æø‡Æ™‡Øç‡Æ™‡Æü‡Øà ‡Æµ‡Øá‡Æ≤‡Øà‡Æï‡Æ≥‡Øç",
            projectsSubtitle: "‡Æµ‡Æø‡Æµ‡Æ∞‡Æô‡Øç‡Æï‡Æ≥‡ØÅ‡Æï‡Øç‡Æï‡ØÅ ‡ÆÆ‡Ææ‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Æ∞‡Øç‡Æï‡Æ≥‡Øà ‡Æï‡Æø‡Æ≥‡Æø‡Æï‡Øç ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡Æµ‡ØÅ‡ÆÆ‡Øç.",
            howTitle: "CivicSpend ‡Æé‡Æ™‡Øç‡Æ™‡Æü‡Æø ‡Æµ‡Øá‡Æ≤‡Øà ‡Æö‡ØÜ‡ÆØ‡Øç‡Æï‡Æø‡Æ±‡Æ§‡ØÅ",
            faqTitle: "‡Æ™‡Øä‡Æ§‡ØÅ‡Æµ‡Ææ‡Æ© ‡Æï‡Øá‡Æ≥‡Øç‡Æµ‡Æø‡Æï‡Æ≥‡Øç",
            loginPromptText: "‡Æµ‡Ææ‡Æï‡Øç‡Æï‡Æ≥‡Æø‡Æï‡Øç‡Æï SMS ‡ÆÆ‡ØÇ‡Æ≤‡ÆÆ‡Øç ‡Æö‡Æ∞‡Æø‡Æ™‡Ææ‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç.",
            votedTitle: "‡ÆÖ‡Æü‡Øà‡ÆØ‡Ææ‡Æ≥‡ÆÆ‡Øç ‡Æö‡Æ∞‡Æø‡Æ™‡Ææ‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æ§‡ØÅ",
            votedSubtitle: "‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æµ‡Ææ‡Æï‡Øç‡Æï‡ØÅ ‡Æ™‡Ææ‡Æ§‡ØÅ‡Æï‡Ææ‡Æ™‡Øç‡Æ™‡Ææ‡Æï ‡Æ™‡Æ§‡Æø‡Æµ‡ØÅ ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æ§‡ØÅ.",
            eduLabel: "‡Æï‡Æ≤‡Øç‡Æµ‡Æø",
            infLabel: "‡Æâ‡Æ≥‡Øç‡Æï‡Æü‡Øç‡Æü‡ÆÆ‡Øà‡Æ™‡Øç‡Æ™‡ØÅ",
            healthLabel: "‡Æö‡ØÅ‡Æï‡Ææ‡Æ§‡Ææ‡Æ∞‡ÆÆ‡Øç",
            sanLabel: "‡Æö‡ØÅ‡Æï‡Ææ‡Æ§‡Ææ‡Æ∞‡ÆÆ‡Øç",
            step1Title: "‡Æü‡Øá‡Æü‡Øç‡Æü‡Ææ ‡Æá‡Æ©‡Øç‡Æú‡ØÜ‡Æ∏‡Øç‡Æö‡Æ©‡Øç",
            step1Desc: "‡Æ®‡Æï‡Æ∞‡Ææ‡Æü‡Øç‡Æö‡Æø ‡ÆÖ‡ÆÆ‡Øà‡Æ™‡Øç‡Æ™‡ØÅ‡Æï‡Æ≥‡ØÅ‡Æü‡Æ©‡Øç ‡Æá‡Æ£‡Øà‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç.",
            step2Title: "‡Æµ‡Æø‡Æö‡ØÅ‡Æµ‡Æ≤‡Æø‡Æö‡Øá‡Æ∑‡Æ©‡Øç",
            step2Desc: "‡Æü‡Øá‡Æü‡Øç‡Æü‡Ææ‡Æµ‡Øà ‡Æö‡Ææ‡Æ∞‡Øç‡Æü‡Øç‡Æü‡ØÅ‡Æï‡Æ≥‡Ææ‡Æï ‡ÆÆ‡Ææ‡Æ±‡Øç‡Æ±‡Æµ‡ØÅ‡ÆÆ‡Øç.",
            step3Title: "‡Æ™‡Æ™‡Øç‡Æ≥‡Æø‡Æï‡Øç ‡ÆÉ‡Æ™‡ØÄ‡Æü‡Øç‡Æ™‡Øá‡Æï‡Øç",
            step3Desc: "‡Æï‡ØÅ‡Æü‡Æø‡ÆÆ‡Æï‡Øç‡Æï‡Æ≥‡Øç ‡Æ™‡Ææ‡Æ§‡ØÅ‡Æï‡Ææ‡Æ™‡Øç‡Æ™‡Ææ‡Æï ‡Æµ‡Ææ‡Æï‡Øç‡Æï‡Æ≥‡Æø‡Æï‡Øç‡Æï‡Æø‡Æ±‡Ææ‡Æ∞‡Øç‡Æï‡Æ≥‡Øç.",
            faq1: "‡Æá‡Æ®‡Øç‡Æ§ ‡Æ§‡Æ∞‡Æµ‡ØÅ ‡Æé‡Æô‡Øç‡Æï‡Æø‡Æ∞‡ØÅ‡Æ®‡Øç‡Æ§‡ØÅ ‡Æµ‡Æ∞‡ØÅ‡Æï‡Æø‡Æ±‡Æ§‡ØÅ?",
            faq1a: "‡Æ®‡Æï‡Æ∞‡Ææ‡Æü‡Øç‡Æö‡Æø ‡Æï‡Ææ‡Æ∞‡Øç‡Æ™‡Øç‡Æ™‡Æ∞‡Øá‡Æ∑‡Æ©‡Øç ‡Æ§‡Æ∞‡Æµ‡ØÅ ‡Æ™‡Øã‡Æ∞‡Øç‡Æü‡Æ≤‡Øç.",
            faq2: "‡Æé‡Æ©‡Øç ‡Æµ‡Ææ‡Æï‡Øç‡Æï‡ØÅ ‡Æé‡Æµ‡Øç‡Æµ‡Æ≥‡Æµ‡ØÅ ‡Æ™‡Ææ‡Æ§‡ØÅ‡Æï‡Ææ‡Æ™‡Øç‡Æ™‡Ææ‡Æ©‡Æ§‡ØÅ?",
            faq2a: "‡Æï‡Æø‡Æ∞‡Æø‡Æ™‡Øç‡Æü‡Øã‡Æï‡Æø‡Æ∞‡Ææ‡Æ™‡Æø‡Æï‡Æ≤‡Ææ‡Æï ‡Æï‡Øà‡ÆØ‡Øä‡Æ™‡Øç‡Æ™‡ÆÆ‡Æø‡Æü‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æ§‡ØÅ.",
            faq3: "‡Æ®‡Ææ‡Æ©‡Øç ‡Æµ‡Ææ‡Æï‡Øç‡Æï‡Øà ‡ÆÆ‡Ææ‡Æ±‡Øç‡Æ± ‡ÆÆ‡ØÅ‡Æü‡Æø‡ÆØ‡ØÅ‡ÆÆ‡Ææ?",
            faq3a: "‡Æí‡Æ∞‡ØÅ ‡Æµ‡Ææ‡Æï‡Øç‡Æï‡ØÅ ‡Æí‡Æ∞‡ØÅ ‡Æé‡Æ£‡Øç‡Æ£‡ØÅ‡Æï‡Øç‡Æï‡ØÅ."
        },
        hi: {
            heroTitle: "‡§∏‡§∞‡§ï‡§æ‡§∞‡•Ä ‡§ñ‡§∞‡•ç‡§ö, <br><span style='color:var(--brand)'>‡§Ü‡§™‡§ï‡•á ‡§≤‡§ø‡§è.</span>",
            heroSubtitle: "CivicSpend Pro ‡§®‡§ó‡§∞‡§™‡§æ‡§≤‡§ø‡§ï‡§æ ‡§°‡•á‡§ü‡§æ ‡§ï‡•ã ‡§∏‡§∞‡§≤ ‡§¨‡§®‡§æ‡§§‡§æ ‡§π‡•à‡•§",
            chartTitle: "‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§∏‡§Ç‡§∏‡§æ‡§ß‡§® ‡§Ü‡§µ‡§Ç‡§ü‡§®",
            voteTitle: "‡§Ö‡§™‡§®‡•Ä ‡§™‡•ç‡§∞‡§æ‡§•‡§Æ‡§ø‡§ï‡§§‡§æ‡§è‡§Å",
            publicStatsTitle: "‡§≤‡§æ‡§á‡§µ ‡§µ‡•ã‡§ü ‡§Ü‡§Å‡§ï‡§°‡§º‡•á",
            publicStatsDesc: "‡§ï‡•á‡§µ‡§≤ ‡§∏‡§Æ‡•á‡§ï‡§ø‡§§ ‡§Ü‡§Å‡§ï‡§°‡§º‡•á‡•§",
            publicTotalVotesLabel: "‡§ï‡•Å‡§≤ ‡§µ‡•ã‡§ü",
            publicTodayVotesLabel: "‡§Ü‡§ú ‡§ï‡•á ‡§µ‡•ã‡§ü",
            publicAvgEducationLabel: "‡§î‡§∏‡§§ ‡§∂‡§ø‡§ï‡•ç‡§∑‡§æ",
            publicAvgInfraLabel: "‡§î‡§∏‡§§ ‡§¨‡•Å‡§®‡§ø‡§Ø‡§æ‡§¶‡•Ä ‡§¢‡§æ‡§Ç‡§ö‡§æ",
            publicAgeTitle: "‡§Ü‡§Ø‡•Å ‡§∏‡§Æ‡•Ç‡§π",
            publicGenderTitle: "‡§≤‡§ø‡§Ç‡§ó",
            projectsTitle: "‡§¨‡•Å‡§®‡§ø‡§Ø‡§æ‡§¶‡•Ä ‡§¢‡§æ‡§Ç‡§ö‡§æ ‡§™‡§∞‡§ø‡§Ø‡•ã‡§ú‡§®‡§æ‡§è‡§Å",
            projectsSubtitle: "‡§µ‡§ø‡§µ‡§∞‡§£ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Æ‡§æ‡§∞‡•ç‡§ï‡§∞ ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç‡•§",
            howTitle: "CivicSpend ‡§ï‡•à‡§∏‡•á ‡§ï‡§æ‡§Æ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à",
            faqTitle: "‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§™‡•ç‡§∞‡§∂‡•ç‡§®",
            loginPromptText: "‡§µ‡•ã‡§ü ‡§¶‡•á‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è SMS ‡§∏‡•á ‡§∏‡§§‡•ç‡§Ø‡§æ‡§™‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç‡•§",
            votedTitle: "‡§™‡§π‡§ö‡§æ‡§® ‡§∏‡§§‡•ç‡§Ø‡§æ‡§™‡§ø‡§§",
            votedSubtitle: "‡§Ü‡§™‡§ï‡§æ ‡§µ‡•ã‡§ü ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ‡•§",
            eduLabel: "‡§∂‡§ø‡§ï‡•ç‡§∑‡§æ",
            infLabel: "‡§¨‡•Å‡§®‡§ø‡§Ø‡§æ‡§¶‡•Ä ‡§¢‡§æ‡§Ç‡§ö‡§æ",
            healthLabel: "‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§∏‡•á‡§µ‡§æ",
            sanLabel: "‡§∏‡•ç‡§µ‡§ö‡•ç‡§õ‡§§‡§æ",
            step1Title: "‡§°‡•á‡§ü‡§æ ‡§á‡§®‡•ç‡§ó‡•á‡§∏‡•ç‡§ü‡§®",
            step1Desc: "‡§®‡§ó‡§∞‡§™‡§æ‡§≤‡§ø‡§ï‡§æ ‡§™‡•ç‡§∞‡§£‡§æ‡§≤‡§ø‡§Ø‡•ã‡§Ç ‡§∏‡•á ‡§ï‡§®‡•á‡§ï‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç‡•§",
            step2Title: "‡§µ‡§ø‡§ú‡§º‡•Å‡§Ö‡§≤‡§æ‡§á‡§ú‡§º‡•á‡§∂‡§®",
            step2Desc: "‡§°‡•á‡§ü‡§æ ‡§ï‡•ã ‡§ö‡§æ‡§∞‡•ç‡§ü ‡§Æ‡•á‡§Ç ‡§¨‡§¶‡§≤‡•á‡§Ç‡•§",
            step3Title: "‡§ú‡§®‡§§‡§æ ‡§ï‡•Ä ‡§™‡•ç‡§∞‡§§‡§ø‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ",
            step3Desc: "‡§®‡§æ‡§ó‡§∞‡§ø‡§ï ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§µ‡•ã‡§ü ‡§ï‡§∞‡§§‡•á ‡§π‡•à‡§Ç‡•§",
            faq1: "‡§Ø‡§π ‡§°‡•á‡§ü‡§æ ‡§ï‡§π‡§æ‡§Å ‡§∏‡•á ‡§Ü‡§§‡§æ ‡§π‡•à?",
            faq1a: "‡§®‡§ó‡§∞ ‡§®‡§ø‡§ó‡§Æ ‡§ï‡§æ ‡§ì‡§™‡§® ‡§°‡•á‡§ü‡§æ ‡§™‡•ã‡§∞‡•ç‡§ü‡§≤‡•§",
            faq2: "‡§Æ‡•á‡§∞‡§æ ‡§µ‡•ã‡§ü ‡§ï‡§ø‡§§‡§®‡§æ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§π‡•à?",
            faq2a: "‡§ï‡•ç‡§∞‡§ø‡§™‡•ç‡§ü‡•ã‡§ó‡•ç‡§∞‡§æ‡§´‡§ø‡§ï ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§π‡§∏‡•ç‡§§‡§æ‡§ï‡•ç‡§∑‡§∞‡§ø‡§§‡•§",
            faq3: "‡§ï‡•ç‡§Ø‡§æ ‡§Æ‡•à‡§Ç ‡§µ‡•ã‡§ü ‡§¨‡§¶‡§≤ ‡§∏‡§ï‡§§‡§æ ‡§π‡•Ç‡§Å?",
            faq3a: "‡§è‡§ï ‡§®‡§Ç‡§¨‡§∞ ‡§™‡§∞ ‡§è‡§ï ‡§µ‡•ã‡§ü‡•§"
        }
    };

    function changeLanguage() {
        currentLanguage = document.getElementById('languageSelect').value;
        applyLanguage(currentLanguage);
    }

    function applyLanguage(lang) {
        const t = translations[lang] || translations.en;
        Object.keys(t).forEach(key => {
            const element = document.getElementById(key);
            if (element) {
                if (key === 'heroTitle') {
                    element.innerHTML = t[key];
                } else {
                    element.textContent = t[key];
                }
            }
        });
        showToast(`Language changed to ${lang === 'en' ? 'English' : lang === 'ta' ? 'Tamil' : 'Hindi'}`, 'success');
    }

    // =====================
    // EXPORT FUNCTIONS
    // =====================
    window.scrollToSection = scrollToSection;
    window.chooseEntry = chooseEntry;
    window.enterAsGuest = enterAsGuest;
    window.openModal = openModal;
    window.closeModal = closeModal;
    window.sendOTP = sendOTP;
    window.verifyOTP = verifyOTP;
    window.adminLogin = adminLogin;
    window.logout = logout;
    window.submitVote = submitVote;
    window.updateSlider = updateSlider;
    window.updateTotal = updateTotal;
    window.filterMapByWard = filterMapByWard;
    window.filterMapByStatus = filterMapByStatus;
    window.reportIssue = reportIssue;
    window.toggleAccordion = toggleAccordion;
    window.downloadCSV = downloadCSV;
    window.downloadJSON = downloadJSON;
    window.downloadPDF = downloadPDF;
    window.exportVoteData = exportVoteData;
    window.changeLanguage = changeLanguage;
    window.toggleChatbot = toggleChatbot;
    window.sendChat = sendChat;

</script>
</body>
</html>
